"use strict";angular.module("stemApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ui.bootstrap","ui.sortable","ui.utils"],["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(mailto|tel|sms|gtalk||):/)}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]);var refreshInterval=6e3;angular.module("stemApp").controller("MainCtrl",["$scope","$filter","Site",function(a,b,c){angular.extend(a,{alerts:{},moment:moment,you:c.You.get(),users:c.Users.get(),userList:function(){return a.$watch("userList",function(a,b){null!==a&&angular.isDefined(a)&&a!==b&&(localStorage.userList=angular.toJson(a))},!0),angular.fromJson(localStorage.userList||"[]")}(),userListType:localStorage.userListType||"grid",userAdd:function(b){b.KeyscanMoment=moment(b.KeyscanUpdated).calendar(),a.userList.push(b)},userUpdate:function(b,c){a.alerts={},b.KeyscanUpdated!==c.KeyscanUpdated&&(c.KeyscanMoment=moment(c.KeyscanUpdated).calendar(),angular.extend(b,c),console.log("Updated Status of: "+b.Name))},userSelected:function(d){var e={UserID:d.UserID};b("filter")(a.userList,e).length||c.User.get(e).$promise.then(a.userAdd,a.userError),a.userSelect=null},userMove:function(b,c){b.preventDefault();var d=$(b.target).closest("user"),e=~[8,37,38].indexOf(b.keyCode)?"prev":"next";d[e]().focus(),~[8,46,void 0].indexOf(b.keyCode)&&(d.addClass(e+"-"+b.type),a.userList.splice(c,1))},userError:function(){a.alerts.user={type:"danger",msg:"Couldn't connect to the API.\nPlease ensure you are connected to the internet andLogged into http://geome.klick.com"}},userGet:setInterval(function(){angular.forEach(a.userList,function(b){c.User.get({UserID:b.UserID}).$promise.then(function(c){a.userUpdate(b,c)},a.userError)})},refreshInterval),userSort:{containment:"parent",cursor:"move",opacity:.75,revert:250,tolerance:"pointer"},ticket:c.Tickets.get()})}]).factory("Site",["$resource",function(a){var b="http://genome.klick.com",c=b+"/api",d={method:"JSONP",params:{format:"json",callback:"JSON_CALLBACK"}};return{You:a(c+"/User/Current",{ForAutocompleter:!0,ForGrid:!0},{get:angular.extend({transformResponse:function(a){return a.Entries[0]}},d)}),Users:a(c+"/User",{ForAutocompleter:!0,ForGrid:!0},{get:d}),User:a(c+"/User",{UserID:"@UserID"},{get:angular.extend({transformResponse:function(a){return a.Entries[0].PhotoPath=b+a.Entries[0].PhotoPath,a.Entries[0]}},d)}),Tickets:a(c+"/Ticket",{ForAutocompleter:!0,ForGrid:!0},{get:d}),Ticket:a(c+"/Ticket",{TicketID:"@TicketID"},{get:d})}}]);